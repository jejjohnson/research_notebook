
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Conditional Variational Inference &#8212; Research Notebook</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Confidence Intervals" href="../confidence_intervals.html" />
    <link rel="prev" title="Variational Inference" href="variational_inference.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../../_static/book_v2.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Research Notebook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../intro.html">
                    Overview
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../resources/python/overview.html">
   Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../resources/python/ides.html">
     Integraded Development Environment (IDE)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../resources/python/stack.html">
     Standard Python Stack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../resources/python/earthsci_stack.html">
     Earth Science Stack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../resources/python/dl_stack.html">
     Deep Learning Stack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../resources/python/scale_stack.html">
     Scaling Stack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../resources/python/good_code.html">
     Good Code
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../tutorials/jax_journey/overview.html">
   My JAX Journey
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tutorials/jax_journey/ecosystem.html">
     Ecosystem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tutorials/jax_journey/vmap.html">
     vmap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tutorials/jax_journey/jit.html">
     Jit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tutorials/jax_journey/classes.html">
     Classes
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../../tutorials/jax_journey/algorithms/overview.html">
     Algorithms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../tutorials/jax_journey/algorithms/bisection.html">
       Bisection search
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../tutorials/jax_journey/algorithms/kernel_derivatives.html">
       Kernel Derivatives
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../../tutorials/jax_journey/gfs_with_jax.html">
       Gaussianization Flows
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../tutorials/remote/overview.html">
   Remote Computing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tutorials/remote/ssh.html">
     SSH Configuration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tutorials/remote/conda.html">
     Conda 4 Remote Servers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../tutorials/remote/jlab.html">
     Jupyter Lab 4 Remote Servers
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../concepts/notation.html">
   Notation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../concepts/quotes.html">
   Quotes
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data/overview.html">
   Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data/representation.html">
     Representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data/models.html">
     Models
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../concepts/uncertainty.html">
   Modeling Uncertainty
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../overview.html">
   Bayesian
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../intro.html">
     Language of Uncertainty
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../models.html">
     Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../inference.html">
     Inference Schemes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="variational_inference.html">
     Variational Inference
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Conditional Variational Inference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../confidence_intervals.html">
     Confidence Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../regression.html">
     Regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../concepts/overview.html">
   Sleeper Concepts
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../concepts/gaussian.html">
     Gaussian Distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../concepts/change_of_variables.html">
     Change of Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../concepts/identity_trick.html">
     Identity Trick
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../concepts/inverse_function.html">
     Inverse Function Theorem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../concepts/jensens.html">
     Jensens Inequality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../concepts/lin_alg.html">
     Linear Algebra Tricks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../kernels/overview.html">
   Kernel Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kernels/kernel_derivatives.html">
     Kernel Derivatives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kernels/rv.html">
     RV Coefficient
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kernels/congruence_coeff.html">
     Congruence Coefficient
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kernels/hsic.html">
     HSIC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kernels/mmd.html">
     Maximum Mean Discrepancy (MMD)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../gps/intro.html">
   Gaussian Processes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../gps/gps.html">
     Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../gps/literature.html">
     Literature Review
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../gps/cg.html">
     Conjugate Gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../gps/sgps.html">
     Sparse Gaussian Processes
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../gps/algorithms.html">
     Algorithms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../gps/gpr_code.html">
       GP from Scratch
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../gps/sgp_code.html">
       Sparse GP From Scratch
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../egps/overview.html">
     Input Uncertainty in GPs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../info_theory/similarity.html">
   Similarity
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../info_theory/overview.html">
   Information Theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../info_theory/measures.html">
     Measures
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../info_theory/information.html">
       Information Theory
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../info_theory/entropy.html">
       Entropy &amp; Relative Entropy
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../info_theory/mutual_info.html">
       Mutual Information and Total Correlation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../info_theory/estimators.html">
     Information Theory Measures
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../info_theory/classic.html">
       Classic Methods
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../info_theory/histogram.html">
       Entropy Estimator - Histogram
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../info_theory/experiments/rbig_sample_consistency.html">
       Experiment - RBIG Sample Consistency
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../normalizing_flows/overview.html">
   Normalizing Flows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../normalizing_flows/linear.html">
     Linear Layers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../normalizing_flows/coupling_layers.html">
     Coupling Layers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../normalizing_flows/conditional.html">
     Conditional Normalizing Flows
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../normalizing_flows/multiscale.html">
     Multiscale
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../normalizing_flows/lecture_1_ig.html">
     Lecture I - Iterative Gaussianization
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../normalizing_flows/1.0_univariate_gauss.html">
       1.1 - Univariate Gaussianization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../normalizing_flows/1.1_marginal_gauss.html">
       1.2 - Marginal Gaussianization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../normalizing_flows/1.2_gaussianization.html">
       1.2 - Iterative Gaussianization
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../normalizing_flows/lecture_2_gf.html">
     Lecture II - Gaussianization Flows
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../normalizing_flows/lecture_3_gfs_pt1_mg.html">
       Parameterized Marginal Gaussianization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../normalizing_flows/lecture_3_gfs_pt2_rot.html">
       Parameterized Rotations
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../normalizing_flows/lecture_3_gfs_pt3_plane.html">
       Example - 2D Plane
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../inr/overview.html">
   Implicit Neural Representations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../inr/formulation.html">
     Formulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../inr/literature_review.html">
     Literature Review
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../inr/pinns.html">
     Physics-Informed Loss
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../inr/qg.html">
       QG PDE
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data_assimilation/overview.html">
   Data Assimilation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data_assimilation/dynamical_sys.html">
     Dynamical Systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data_assimilation/oi.html">
     Optimal Interpolation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data_assimilation/interp.html">
     Interpolation Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data_assimilation/emu.html">
     Emulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data_assimilation/inv_problems.html">
     Inverse Problems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data_assimilation/projects.html">
     Projects
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../data_assimilation/algorithms.html">
     Algorithms
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/markov_models.html">
       Markov Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/gauss_markov.html">
       Gauss-Markov Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/kf.html">
       Kalman Filter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/nkf.html">
       Normalizing Kalman Filter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/enskf.html">
       Ensemble Kalman Filter
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/dmm.html">
       Deep Markov Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/4dvarnet.html">
       4DVarNet
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../data_assimilation/markov_gp.html">
       Markovian Gaussian Processes
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../misc/overview.html">
   Miscellaneous Notes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../misc/generative_models.html">
     Generative Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../misc/diffusion_models.html">
     Diffusion Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../misc/fixed_point.html">
     Fixed-Point Methods
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Cheat Sheets
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cheatsheets/bash.html">
   Bash
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cheatsheets/cli.html">
   Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cheatsheets/python.html">
   Python
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jejjohnson/research_notebook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jejjohnson/research_notebook/issues/new?title=Issue%20on%20page%20%2Fcontent/notes/bayesian/inference/cond_vi.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../../_sources/content/notes/bayesian/inference/cond_vi.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivations">
   Motivations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#elbo-encoder-derivation">
   ELBO (Encoder) - Derivation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reconstruction-loss">
   Reconstruction Loss
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volume-correction">
   Volume Correction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variational-free-energy-vfe">
   Variational Free Energy (VFE)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prior-guess">
   Prior Guess
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Conditional Variational Inference</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivations">
   Motivations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#elbo-encoder-derivation">
   ELBO (Encoder) - Derivation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reconstruction-loss">
   Reconstruction Loss
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volume-correction">
   Volume Correction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variational-free-energy-vfe">
   Variational Free Energy (VFE)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prior-guess">
   Prior Guess
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="conditional-variational-inference">
<h1>Conditional Variational Inference<a class="headerlink" href="#conditional-variational-inference" title="Permalink to this headline">#</a></h1>
<hr class="docutils" />
<section id="motivations">
<h2>Motivations<a class="headerlink" href="#motivations" title="Permalink to this headline">#</a></h2>
<p>Variational inference is the most scalable inference method the machine learning community has (as of 2019).</p>
<p>Ultimately, we are interested in approximating the likelihood distribution of our observations, <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span>, which we assume come from some <span class="math notranslate nohighlight">\(\mathcal{X}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
y \sim p(y|x)
\]</div>
<p>We write some sort of approximation of the <em>true</em> (or best) underlying distribution via some parameterized form like so</p>
<div class="math notranslate nohighlight">
\[
p_*(\mathbf{y}|\mathbf{x}) \approx p_{\boldsymbol \theta}(\mathbf{y}|\mathbf{x}).
\]</div>
<p>We can do the discriminative version which just means fitting a function to approximate the likelihood</p>
<div class="math notranslate nohighlight">
\[
\mathbf{y} = \boldsymbol{f_\theta}(\mathbf{x}) + \epsilon
\]</div>
<p>However, we’re often not happy with this approximation and would prefer a more probabilistic interpretation. Another method would be to assume some latent variable, <span class="math notranslate nohighlight">\(z\)</span>, also plays a pivotal role in order to obtain a probabilistic interpretation.</p>
<div class="math notranslate nohighlight">
\[
\mathbf{y} = \boldsymbol{f_\theta}(\mathbf{x},\mathbf{z}) + \epsilon
\]</div>
<p>So how do we express this in a more bayesian way? We can use the same methodology for VIs but we will always be conditioned on, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>. So again, we need to assume some latent variable, <span class="math notranslate nohighlight">\(\mathbf{z}\)</span>, plays a role in estimating the underlying conditional density estimation of <span class="math notranslate nohighlight">\(\mathbf{y}\)</span>. In the simplest form, we assume a generative model for the joint distribution can be written as</p>
<div class="math notranslate nohighlight">
\[
p_\theta(y,z|x) = p(y|z,x)p(z|x)
\]</div>
<p>When fitting a model, we are interested in maximizing the marginal likelihood</p>
<div class="math notranslate nohighlight">
\[
p_\theta(y|x) = \int p_\theta(y|z,x)p_\theta(z|x)dz
\]</div>
<p>However, this quantity is intractable because we have a non-linear function thats within an integral.  So we use an variational distribution, <span class="math notranslate nohighlight">\(q_\phi(z|x,y)\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\log p_\theta(y|x) = \mathbb{E}_{q_\phi(z|x,y)}\left[ \log p_\theta(y|x) \right]
\]</div>
<p>Like the VI section, we have many types of conditional variational distributions we can impose. For example, we have some of the following:</p>
<ul class="simple">
<li><p><em>Conditional Gaussian</em>, <span class="math notranslate nohighlight">\(q(z|x)\)</span></p></li>
<li><p><em>Conditional Mixture Distribution</em>, <span class="math notranslate nohighlight">\(\sum_{k}^{K}\pi_k \mathbb{P}(z|x)\)</span></p></li>
<li><p><em>Conditional Bijective Transform</em> (Flow), <span class="math notranslate nohighlight">\(q(z|\tilde{z},x)\)</span></p></li>
<li><p><em>Conditional Stochastic Transform</em>, <span class="math notranslate nohighlight">\(q(z|y,x)\)</span></p></li>
</ul>
<p>We won’t go through each of these like in the previous section because it is <em>relatively</em> straightforward to extend each of the previous section to include a conditional rv.</p>
</section>
<hr class="docutils" />
<section id="elbo-encoder-derivation">
<h2>ELBO (Encoder) - Derivation<a class="headerlink" href="#elbo-encoder-derivation" title="Permalink to this headline">#</a></h2>
<blockquote>
<div><p>This derivation comes from the book by <a class="reference internal" href="../inference.html"><span class="doc std std-doc">paper</span></a> and the blog post from <a class="reference internal" href="../inference.html"><span class="doc std std-doc">pyro-ppl/CVAE</span></a>. I find it to be a much better and intuitive derivation.</p>
</div></blockquote>
<p><strong>Note</strong>: I put the <em>encoder</em> tag in the title. This is because there are other ELBOs that have different purposes, for example, variational distributions without an encoder and also an encoder for conditional likelihoods. In this first one, we will like at the ELBO derivation</p>
<p><strong>Note</strong>: This derivation is more or less <em>the exact same</em> as the standard VI however it will include the conditional term, <span class="math notranslate nohighlight">\(q(\cdot|\cdot,x),p(\cdot|\cdot,x)\)</span>.</p>
<p>As mentioned above, we are interested in expanding the expectation of the marginal likelihood wrt the encoder variational distribution</p>
<div class="math notranslate nohighlight">
\[
\log p_\theta(y|x) = \mathbb{E}_{q_\phi(z|x,y)}\left[ \log p_\theta(y|x) \right]
\]</div>
<p>We will do a bit of mathematical manipulation to expand this expectation. Firstly, we will start with Bayes rule:</p>
<div class="math notranslate nohighlight">
\[
p_\theta(y|x) = \frac{p_\theta(z,y|x)}{p_\theta(z|y,x)}
\]</div>
<p>Plugging this into our expectation gives us:</p>
<div class="math notranslate nohighlight">
\[
\log p_\theta(y|x) = \mathbb{E}_{q_\phi(z|x)}\left[ \log \frac{p_\theta(z,y|x)}{p_\theta(z|y,x)} \right]
\]</div>
<p>Now we will do the identity trick (multiply by 1/1 :) ) within the log term to incorporate the variational distribution, <span class="math notranslate nohighlight">\(q_\phi\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\log p_\theta(y|x) = \mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(z,y|x)q_\phi(z|y,x)}{p_\theta(z|y,x)q_\phi(z|y,x)} \right] = \mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(z,y|x)q_\phi(z|y,x)}{q_\phi(z|y,x)p_\theta(z|y,x)} \right]
\]</div>
<p>Using the log rules, we can split this fraction into two fractions;</p>
<div class="math notranslate nohighlight">
\[
\log p_\theta(y|x) =  \mathbb{E}_{q_\phi(z|x)}\left[ \log \frac{p_\theta(z,y|x)}{q_\phi(z|y,x)} + \log \frac{q_\phi(z|y,x)}{p_\theta(z|y,x)} \right]
\]</div>
<p>Now, we can expand the expectation term across the additive operator</p>
<div class="math notranslate nohighlight">
\[
\log p_\theta(y|x) =  \mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(z,y|x)}{q_\phi(z|y,x)} \right] + \mathbb{E}_{q_\phi(z|y,x)}\left[\log \frac{q_\phi(z|y,x)}{p_\theta(z|y,x)} \right]
\]</div>
<p>Here, we notice that the second term is actually the Kullback-Leibler divergence term.</p>
<div class="math notranslate nohighlight">
\[
\text{D}_{\text{KL}} [Q||P] = \mathbb{E}_Q\left[\log \frac{Q}{P} \right] = - \mathbb{E}_Q\left[\log \frac{P}{Q} \right]
\]</div>
<p>so we can replace this with the more compact form.</p>
<div class="math notranslate nohighlight">
\[
\log p_\theta(y|x) =  \mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(z,y|x)}{q_\phi(z|y,x)} \right] + \text{D}_{\text{KL}} \left[q_\phi(z|y,x)||p_\theta(z|y,x) \right]
\]</div>
<p>We know from theory that the KL divergence term is always zero or positive. So this means that we can draw a bound on the first term in terms of the marginal log-likelihood.</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}:=\mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(z,y|x)}{q_\phi(z|y,x)} \right] \leq \log p_\theta(y|x)
\]</div>
<p>This term is called the Evidence Lower Bound (ELBO). So the objective is to <em>maximize</em> this term which will also minimize the KLD.</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}=\mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(z,y|x)}{q_\phi(z|y,x)} \right]
\]</div>
<p>So now, we can expand the joint distribution using Bayes rule, i.e. <span class="math notranslate nohighlight">\(p(y,z|x)=p(y|z,x)p(z|x)\)</span>, to give us.</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}=\mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p(y|z,x)p(z|x)}{q_\phi(z|y,x)} \right]
\]</div>
<p>We can also expand this fraction using the log rules,</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}=\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p(y|z,x) + \log p(z|x) - \log q_\phi(z|y,x) \right].
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(q_\phi(z|y,x)\)</span> - (conditional) prior network</p></li>
<li><p><span class="math notranslate nohighlight">\(p_\theta(y|z,x)\)</span> - generation network</p></li>
<li><p><span class="math notranslate nohighlight">\(p_\theta(z|x)\)</span> - prior network</p></li>
<li><p><span class="math notranslate nohighlight">\(p_\theta(y|x)\)</span> - (pretrained) baseline network</p></li>
</ul>
<p>Now, we have some options on how we can group the likelihood, the prior and the variational distribution together and each of them will offer a slightly different interpretation and application.</p>
</section>
<hr class="docutils" />
<section id="reconstruction-loss">
<h2>Reconstruction Loss<a class="headerlink" href="#reconstruction-loss" title="Permalink to this headline">#</a></h2>
<p>If we group the prior probability and the variational distribution together, we get:</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}=\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p(y|z,x) \right] + \mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p(z|x)}{q_\phi(z|y,x)} \right].
\]</div>
<p>This is the same KLD term as before but in the reverse order. So with a slight of hand in terms of the signs, we can rearrange the term to be</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}= \mathbb{E}_{q_\phi(z|y,x)}\left[ \log p(y|z,x) \right] - \mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{q_\phi(z|y,x)} {p(z|x)}\right].
\]</div>
<hr class="docutils" />
<p><strong>Proof</strong>:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}_q[ \log p - \log q] = - \mathbb{E}_q[\log q - \log p] = - \mathbb{E}_q[\log\frac{q}{p}]
\]</div>
<p><strong>QED</strong>.</p>
<hr class="docutils" />
<p>So now, we have the exact same KLD term as before. Let’s use the simplified form.</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}={\color{blue}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p_\theta(y|z,x) \right]} - {\color{green}\text{D}_\text{KL}\left[q_\phi(z|y,x)||p_\theta(z|x)\right]}.
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\({\color{blue}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p_\theta(y|z,x) \right]}\)</span> - is the <span class="math notranslate nohighlight">\(\color{blue}\text{reconstruction loss}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\({\color{green}\text{D}_\text{KL}\left[q_\phi(z|y,x)||p_\theta(z|x)\right]}\)</span> - is the complexity, i.e. the <span class="math notranslate nohighlight">\(\color{green}\text{KL divergence}\)</span> (a distance metric) between the prior and the variational distribution.</p></li>
</ul>
<p>This is easily the most common ELBO term especially with conditional Variational AutoEncoders (cVAEs). The first term is the expectation of the likelihood term wrt the variational distribution. The second term is the KLD between the prior and the variational distribution.</p>
</section>
<hr class="docutils" />
<section id="volume-correction">
<h2>Volume Correction<a class="headerlink" href="#volume-correction" title="Permalink to this headline">#</a></h2>
<p>Another approach is more along the lines of the transform distribution. Assume we have our original data domain <span class="math notranslate nohighlight">\(\mathcal{X}\)</span> and we have some stochastic transformation, p(z|y,x), which transforms the data from our original domain to a transform domain, <span class="math notranslate nohighlight">\(\mathcal{Z}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
z \sim p_\theta(z|y,x)
\]</div>
<p>To acquire this, let’s look at the equation again</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}=\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p_\theta(y|z,x) + \log p_\theta(z|x) - \log q_\phi(z|y,x) \right].
\]</div>
<p>except this time we will isolate the prior and combine the likelihood and the variational distribution.</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}={\color{blue}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p_\theta(z|x) \right]} + {\color{green}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(y|z,x)}{q_\phi(z|y,x)} \right]}.
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\({\color{blue}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p_\theta(z|x) \right]}\)</span> - is the expectation of the transformed distribution, aka the <span class="math notranslate nohighlight">\({\color{blue}\text{reparameterized probability}}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\({\color{green}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log \frac{p_\theta(y|z,x)}{q_\phi(z|y,x)} \right]}\)</span> - is the ratio between the inverse transform and the forward transform , i.e. <span class="math notranslate nohighlight">\({\color{green}\text{Volume Correction Factor}}\)</span> or <em>likelihood contribution</em>.</p></li>
</ul>
<p><strong>Source</strong>: I first saw this approach in the SurVAE Flows paper.</p>
</section>
<hr class="docutils" />
<section id="variational-free-energy-vfe">
<h2>Variational Free Energy (VFE)<a class="headerlink" href="#variational-free-energy-vfe" title="Permalink to this headline">#</a></h2>
<p>There is one more main derivation that remains (that’s often seen in the literature). Looking at the equation again</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}=\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p_\theta(y|z,x) + \log p(z|x) - \log q_\phi(z|y,x) \right],
\]</div>
<p>we now isolate the likelihood <em>and</em> the prior under the variational expectation. This gives us:</p>
<div class="math notranslate nohighlight">
\[
 \mathcal{L}_{\text{ELBO}}={\color{blue}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log _\theta(y|z,x) p_\theta(z|x)\right]} - {\color{green} \mathbb{E}_{q_\phi(z|y,x)}\left[ \log q_\phi(z|y,x) \right]}.
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\({\color{blue}\mathbb{E}_{q_\phi(z|y,x)}\left[ \log p_\theta(y|z,x) p_\theta(z|x)\right]}\)</span> - is the <span class="math notranslate nohighlight">\({\color{blue}\text{energy}}\)</span> function</p></li>
<li><p><span class="math notranslate nohighlight">\({\color{green} \mathbb{E}_{q_\phi(z|y,x)}\left[ \log q_\phi(z|y,x) \right]}\)</span> - is the <span class="math notranslate nohighlight">\({\color{green}\text{entropy}}\)</span></p></li>
</ul>
<p><strong>Source</strong>: I see this approach a lot in the Gaussian process literature when they are deriving the Sparse Gaussian Process from Titsias.</p>
</section>
<section id="prior-guess">
<h2>Prior Guess<a class="headerlink" href="#prior-guess" title="Permalink to this headline">#</a></h2>
<p>We can also utilize an initial guess from a baseline model, <span class="math notranslate nohighlight">\(p_\theta(y|x)\)</span>. This can be fed as an input into the encoder, <span class="math notranslate nohighlight">\(q(z|x,y)\)</span>.</p>
<div class="highlight-python= notranslate"><div class="highlight"><pre><span></span># =========
# MODEL
# =========
x, y = ..., Optional
# inputs into the baseline net, p(y|x)
y_hat = baseline_net(x)

# inputs to the prior net, q(z|y,x)
z_loc, z_scale = prior_net(x, y_hat)

# sample from distribution
z_samples = sample(&quot;z&quot;, Normal(z_loc, z_scale))

# output from the generation net, p(y|z)
loc = generation_net(z)

# w/ observations
# training, we can do masking tricks
mask_loc = ...
mask_scale = ...
mask_y = ...

# sample from dist
sample(&quot;y&quot;, Normal(mask_loc, mask_scale), obs=mask_y)

# w/o observations
deterministic(&quot;y&quot;, mask_loc.detach())

# =========
# GUIDE
# =========
x, ys = ..., Optional

# with observations
# use baseline net
y_hat = baseline_net(x)
# prior net, q(z|y,x)
loc, scale = prior_net(x, y_hat)
# sample from Normal
sample(&quot;z&quot;, Normal(loc, scale))

# w/o observations
loc, scale = recognition_net(x, None)
# sample from normal
sample(&quot;z&quot;, Normal(loc, scale))
</pre></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/notes/bayesian/inference"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="variational_inference.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Variational Inference</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../confidence_intervals.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Confidence Intervals</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By J. Emmanuel Johnson<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>